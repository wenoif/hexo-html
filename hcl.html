<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>路由交换学习及HCL使用笔记 | 博客</title><meta name="keywords" content="路由交换,华三HCL"><meta name="author"><meta name="copyright"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="README先学习了“H3C网络学院路由交换技术第1卷”上下册，跟着书中做实验时候，很多命令都因HCL模拟器版本更新出现了错误。然后找到了“路由与交换技术高级配置教程”，里面的命令都和当前HCL模拟器最新版本一样，跟着做了实验。  H3C模拟器下载：点击这里   下载地址中有两个版本，分别推荐win7和win10，下载需要登陆，选择合作伙伴，用户yx800，密码01230123 华三云实验室（HC">
<meta property="og:type" content="article">
<meta property="og:title" content="路由交换学习及HCL使用笔记">
<meta property="og:url" content="https://github.com/wenoif/hcl.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="README先学习了“H3C网络学院路由交换技术第1卷”上下册，跟着书中做实验时候，很多命令都因HCL模拟器版本更新出现了错误。然后找到了“路由与交换技术高级配置教程”，里面的命令都和当前HCL模拟器最新版本一样，跟着做了实验。  H3C模拟器下载：点击这里   下载地址中有两个版本，分别推荐win7和win10，下载需要登陆，选择合作伙伴，用户yx800，密码01230123 华三云实验室（HC">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-06-05T23:50:54.000Z">
<meta property="article:modified_time" content="2021-09-06T15:50:07.276Z">
<meta property="article:tag" content="路由交换">
<meta property="article:tag" content="华三HCL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wenoif/blog/WENOIF/avatar.jpg"><link rel="canonical" href="https://github.com/wenoif/hcl"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-06 23:50:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/wenoif/blog/WENOIF/avatar.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/wenoif/blog/WENOIF/main.jpg'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">40</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw iconfont icon-jia"></i><span> 博客首页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw iconfont icon-guidang1"></i><span> 文章归档</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://wenoif.github.io"><i class="fa-fw icon-jia"></i><span> 个人主页</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/blog/">博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw iconfont icon-jia"></i><span> 博客首页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw iconfont icon-guidang1"></i><span> 文章归档</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://wenoif.github.io"><i class="fa-fw icon-jia"></i><span> 个人主页</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">路由交换学习及HCL使用笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2021-06-05T23:50:54.000Z" title="undefined 2021-06-06 07:50:54">2021-06-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/blog/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>49分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="README"><a href="#README" class="headerlink" title="README"></a>README</h2><p>先学习了“H3C网络学院路由交换技术第1卷”上下册，跟着书中做实验时候，很多命令都因HCL模拟器版本更新出现了错误。然后找到了“路由与交换技术高级配置教程”，里面的命令都和当前HCL模拟器最新版本一样，跟着做了实验。</p>
<ul>
<li><p>H3C模拟器下载：<a target="_blank" rel="noopener" href="https://www.h3c.com/cn/Service/Document_Software/Software_Download/Other_Product/H3C_Cloud_Lab/Catalog/HCL/">点击这里</a> </p>
<ul>
<li>下载地址中有两个版本，分别推荐win7和win10，下载需要登陆，选择合作伙伴，用户yx800，密码01230123</li>
<li>华三云实验室（HCL）V2.1.1是新华三集团基于HCL V2.0.1推出的功能更强大的界面图形化全真网络设备模拟软件。HCL V2.1.1软件内VirtualBox版本为5.1.22，推荐在win7系统运行。</li>
<li>华三云实验室（HCL）V2.1.2是新华三集团基于HCL V2.0.1推出的功能更强大的界面图形化全真网络设备模拟软件。HCL V2.1.2软件内VirtualBox版本为6.0.14，推荐在win10系统运行</li>
</ul>
</li>
<li><p>H3C模拟器-CMD帮助文档在线：<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/index.htm">首页</a>、<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/toc.htm">目录页</a>、<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/search.htm">搜索页</a>、<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/default.htm">默认页</a>；</p>
<p>本文档为HCL安装目录获得，因htm文件的编码是ANSI，采用下面的Python 3脚本将编码批量修改成UTF-8。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 将当前目录下的所有htm文件编码 修改为utf8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> chardet <span class="keyword">import</span> detect</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计数找到了多少个htm文件</span></span><br><span class="line">count=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历目录</span></span><br><span class="line"><span class="keyword">for</span> filepath,dirnames,filenames <span class="keyword">in</span> os.walk(<span class="string">r&#x27;./&#x27;</span>):</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        print(<span class="string">&quot;os.path.join(filepath,filename):&quot;</span>,os.path.join(filepath,filename))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 分割后缀</span></span><br><span class="line">        filename_split = filename.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 判断后缀名</span></span><br><span class="line">            <span class="keyword">if</span> filename_split[<span class="number">-1</span>] == <span class="string">&#x27;htm&#x27;</span>:</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 计数</span></span><br><span class="line">                count=count+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">#print(filename_split)</span></span><br><span class="line">                filename=os.path.join(filepath,filename)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    s = f.read()</span><br><span class="line">                coding = detect(s)[<span class="string">&#x27;encoding&#x27;</span>]</span><br><span class="line">                <span class="comment">#编码方式</span></span><br><span class="line">                print(<span class="string">&#x27;coding: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(coding))</span><br><span class="line">               <span class="comment">#文件内容</span></span><br><span class="line">                <span class="comment">#print(&#x27;content: &#123;&#125;&#x27;.format(s.decode(coding).rstrip()))</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> coding==<span class="literal">None</span>:</span><br><span class="line">                    coding=<span class="string">&quot;utf-8&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(s.decode(coding,<span class="string">&#x27;ignore&#x27;</span>).encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">                    print(<span class="string">f&#x27;第<span class="subst">&#123;count&#125;</span>个htm文件====<span class="subst">&#123;filename&#125;</span>=====已经转换&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment">#print(os.path.join(filepath,filename))</span></span><br><span class="line">            print(e)</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h2 id="H3C网络学院路由交换技术第1卷"><a href="#H3C网络学院路由交换技术第1卷" class="headerlink" title="H3C网络学院路由交换技术第1卷"></a>H3C网络学院路由交换技术第1卷</h2><p>电子资源：</p>
<ul>
<li>“H3C网络学院路由交换技术第1卷上”PDF（<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%20(%E4%B8%8A).pdf">预览</a>；<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/wenoif/hcl/main/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%20(%E4%B8%8A).pdf">下载</a>）</li>
<li>“H3C网络学院路由交换技术第1卷下”PDF（<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%20(%E4%B8%8B).pdf">预览</a>；<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/wenoif/hcl/main/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%20(%E4%B8%8B).pdf">下载</a>）</li>
<li>“H3C网络学院路由交换技术第1卷上-课程实验”PDF（<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%E4%B8%8A-%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C.pdf">预览</a>；<a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/wenoif/hcl/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%E4%B8%8A-%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C.pdf">预览</a>；<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/wenoif/hcl/main/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%E4%B8%8A-%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C.pdf">下载</a>）</li>
<li>“H3C网络学院路由交换技术第1卷下-课程实验”PDF（<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%E4%B8%8B-%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C.pdf">预览</a>；<a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/wenoif/hcl/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%E4%B8%8B-%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C.pdf">预览</a>；<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/wenoif/hcl/main/source/H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%E4%B8%8B-%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C.pdf">下载</a>）</li>
<li>“H3C网络学院路由交换技术第1卷上”ANKI牌组（<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/wenoif/hcl/main/source/%E5%AD%A6%E4%B9%A0%20H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%20(%E4%B8%8A).apkg">下载</a>）</li>
<li>“H3C网络学院路由交换技术第1卷下”ANKI牌组（<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/wenoif/hcl/main/source/%E5%AD%A6%E4%B9%A0%20H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7%20(%E4%B8%8B).apkg">下载</a>）</li>
</ul>
<h3 id="命令整理"><a href="#命令整理" class="headerlink" title="命令整理"></a>命令整理</h3><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p><strong>system-view</strong>命令用来从用户视图进入系统视图。</p>
<p><strong>interface</strong>命令用来进入相应接口/子接口视图。如果进入视图前，相应子接口不存在，则先创建子接口，再进入该子接口视图。</p>
<p><strong>ip</strong> <strong>address</strong>命令用来配置接口的IP地址。</p>
<p><strong>undo</strong> <strong>ip</strong> <strong>address</strong>命令用来删除接口的IP地址。</p>
<p><strong>display ip routing-table</strong>命令用来显示IPv4路由信息表。</p>
<h4 id="信息查看"><a href="#信息查看" class="headerlink" title="信息查看"></a>信息查看</h4><p>查看版本信息：display version<br>查看当前设备运行的配置：display current-configuration<br>查看所有接口信息：display interface<br>查看接口简要信息：display ip interface brief<br>查看当前各个主要功能模块运行的统计信息：display diagnostic-information</p>
<p>display interface brief 查看端口状态<br>display ip routing-table 查看路由表</p>
<h4 id="调试输出"><a href="#调试输出" class="headerlink" title="调试输出"></a>调试输出</h4><p>在用户视图模式下打开屏幕输出开关：terminal monitor</p>
<p>在用户视图模式下打开调试输出开关：terminal debugging</p>
<h4 id="清除配置"><a href="#清除配置" class="headerlink" title="清除配置"></a>清除配置</h4><p>如果仅仅是删除个别配置，使用undo+相应的配置即可。<br>如果删除整个端口的配置，可以在进入端口后使用default命令</p>
<p>重置配置并重启：<br>reset saved-configuration<br>reboot</p>
<h4 id="历史记录"><a href="#历史记录" class="headerlink" title="历史记录"></a>历史记录</h4><p>display  history-command 查看历史记录。<br>history-command max-size 命令用来设置历史命令缓冲区的大小。<br>undo history-command max-size 命令用来恢复历史命令缓冲区的大小为缺省值，缺省情况下，存放10条历史命令。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">system-view </span><br><span class="line">user-interface console 0</span><br><span class="line">history-command max-size 100</span><br></pre></td></tr></table></figure>





<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>display saved-configuration 起始配置内容<br>display current-configuration 当前配置信息<br>display startup 当前和下次使用的配置文件<br>display this 当前视图下生效的配置信息</p>
<p>保存配置文件：save；<br>默认名称为：startup.cfg；<br>拓展名为：*.cfg；<br>删除已经保存的配置文件：reset saved-configuration；</p>
<h4 id="分页查看"><a href="#分页查看" class="headerlink" title="分页查看"></a>分页查看</h4><p>最后一行出现“—-more—-”时候：<br>空格Space=翻页；<br>回车Enter=翻行；<br>Ctrl+C=退出；</p>
<h4 id="时间管理"><a href="#时间管理" class="headerlink" title="时间管理"></a>时间管理</h4><p>查看系统时间：display clock<br>修改系统时间：<br>先进入系统视图关闭时钟服务器：<code>clock protocol none</code>；<br>返回用户视图设置时间：<code>clock datetime hh:mm:ss year/month/day</code>；<br>设置时区为北京，在UTC偏移8小时：<code>clock timezone beijing add 8</code>；</p>
<h4 id="设备管理"><a href="#设备管理" class="headerlink" title="设备管理"></a>设备管理</h4><p>系统视图下修改设备名称：sysname [NAME]</p>
<h4 id="视图切换"><a href="#视图切换" class="headerlink" title="视图切换"></a>视图切换</h4><p>进入系统视图：system-view，提示符为[ ]<br>退出/返回上一个视图：quit</p>
<h3 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h3><h4 id="Console登录"><a href="#Console登录" class="headerlink" title="Console登录"></a>Console登录</h4><p>在win10主机上用console口登录HCL中的路由器：先在HCL中创建开启一台路由器；在Virtual Box查看虚拟路由器的名称；打开SecureCRT新建连接：协议类型=serial，端口=Named Pipe，Named of pipe=<code>\\.\pipe\[Virtual Box虚拟路由器的名称]</code>，例如<code>\\.\pipe\topo1-device1</code>；</p>
<p><strong>console和serial</strong>：Consol口是一个本地连接口，只能用来进行本地配置；Serial口是广域网口，可以连接到运营商的网络中，其封装协议有很多以适应广域网的链路，是很贵的接口。</p>
<h4 id="Telnet登录"><a href="#Telnet登录" class="headerlink" title="Telnet登录"></a>Telnet登录</h4><p>在端口视图中设置IP地址；<br>在系统视图中开启telnet；<br>在VTY视图中配置验证方式；</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface GigabitEthernet 0&#x2F;0</span><br><span class="line">ip address 192.168.56.2 255.255.255.0</span><br><span class="line">quit</span><br><span class="line">telnet server enable </span><br><span class="line">user-interface vty0</span><br><span class="line">authentication-mode none</span><br></pre></td></tr></table></figure>



<h4 id="SSH登录"><a href="#SSH登录" class="headerlink" title="SSH登录"></a>SSH登录</h4><p>在端口视图中设置IP地址；<br>在系统视图中开启SSH服务器；<br>在VTY视图中配置验证方式[scheme是组合的意思.就是组合认证方式,即输入:用户名+密码认证；password 只使用密码；none不需要密码]和允许接入的类型；<br>配置本地SSH用户；</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface GigabitEthernet 0&#x2F;0</span><br><span class="line">ip address 192.168.56.2 255.255.255.0</span><br><span class="line">quit</span><br><span class="line">ssh server enable </span><br><span class="line">user-interface vty 0 4</span><br><span class="line">authentication-mode scheme </span><br><span class="line">protocol inbound ssh </span><br><span class="line">quit</span><br><span class="line">local-user sshtest</span><br><span class="line">password simple 123456</span><br><span class="line">service-type ssh </span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>ssh连接时候报错：<code>no matching cipher found. Thei r offer: aes128-cbc,aes256-cbc,3des-cbc,des-cbc</code>，原因是因为SSH客户端版本过高。<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43274859/article/details/103478705">https://blog.csdn.net/qq_43274859/article/details/103478705</a></p>
<h4 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h4><p>在端口视图中设置IP地址；<br>在系统视图中开启FTP服务器；<br>配置本地用户，密码，优先级；</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface GigabitEthernet 0&#x2F;0</span><br><span class="line">ip address 192.168.56.2 255.255.255.0</span><br><span class="line">quit</span><br><span class="line">ftp server enable </span><br><span class="line">local-user ftpu</span><br><span class="line">service-type ftp</span><br><span class="line">password simple 123456</span><br><span class="line">authorization-attribute user-role level-15</span><br></pre></td></tr></table></figure>



<p><strong>用户优先级 level-n (n = 0～15)：</strong><br><strong>level-0</strong>：可执行命令ping、tracert、ssh2、telnet和super，且管理员可以为其配置权限<br><strong>level-1</strong>：具有level-0用户角色的权限，并且可执行系统所有功能和资源的相关display命令（除display history-command all之外），以及管理员可以为其配置权限<br><strong>level-2～level-8和level-10～level-14</strong>：无缺省权限，需要管理员为其配置权限<br><strong>level-9</strong>：可操作系统中绝大多数的功能和所有的资源，且管理员可以为其配置权限，但不能操作display history-command all命令、RBAC的命令（Debug命令除外）、文件管理、设备管理以及本地用户特性。对于本地用户，若用户登录系统并被授予该角色，可以修改自己的密码<br><strong>level-15</strong>：具有与network-admin角色相同的权限</p>
<h2 id="路由与交换技术高级配置教程"><a href="#路由与交换技术高级配置教程" class="headerlink" title="路由与交换技术高级配置教程"></a>路由与交换技术高级配置教程</h2><p>电子资源：</p>
<ul>
<li>“路由与交换技术高级配置教程”PDF（<a target="_blank" rel="noopener" href="https://officeonline.superlib.com/3rd/proxy.html?objectid=7c7ac3ef9992a5e1daf285ac549ca2c8&suffix=pdf">预览</a>；<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/source/%E8%B7%AF%E7%94%B1%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B%20.pdf">预览</a>；<a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/wenoif/hcl/source/%E8%B7%AF%E7%94%B1%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B%20.pdf">预览</a>；<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/wenoif/hcl/main/source/%E8%B7%AF%E7%94%B1%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B%20.pdf">下载</a>）</li>
<li>HCL模拟器实验拓扑（<a href="https://github.com/wenoif/hcl/tree/main/topology">下载</a>）</li>
</ul>
<p>文中引用借鉴文字包括不限于以下，感谢：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.51cto.com/jinfeng/98950">OSPF区域与路由聚合</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.51cto.com/shenzhenvc/1970630">路由引入技术总结</a></li>
</ul>
<h3 id="勘误"><a href="#勘误" class="headerlink" title="勘误"></a>勘误</h3><p>这是“路由与交换技术高级配置教程”在进行实验过程中发现的一些错误（也可能是我理解错误）：</p>
<ul>
<li>P18 步骤四中“display gvrp statistics” 的”gvrp”应为“mvrp”；</li>
<li>P23 步骤四中“interfaceVlan-interface 20”中“interface”后缺少空格；</li>
<li>P24 步骤四中“portGigabitEthernet 1/0/1”中“port”后缺少空格；</li>
<li>p45 倒数第三行启动STP命令“stp  enable”，只能在端口视图中使用。<ul>
<li>系统视图中使用“stp global enable”，而“stp  enable”只能在端口视图中使用。</li>
<li>全局开启stp命令为“stp global enable”，<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/-1069272936/1984907096/351986724.htm?-984779656">查看文档</a>；</li>
<li>端口开启stp命令为“stp  enable”，<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/-1069272936/1984907096/351986724.htm?292469485">查看文档</a>。</li>
</ul>
</li>
<li>p45 倒数第一行 查看根桥角色应使用“display stp root”，原文中遗漏“root”，<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/-1069272936/1984907096/351986724.htm?-430817875">查看文档</a>。</li>
<li>P48 步骤一 开启STP功能。同p45倒数第三行的。</li>
<li>p53 第4行、第6行：配置为边缘端口的命令“stp edged-port enable”无法使用<ul>
<li>经查文档“stp edged-port“命令用来配置当前端口为边缘端口，后面无需跟enable，<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/-1069272936/1984907096/351986724.htm?-2036448749">查看文档</a>。</li>
</ul>
</li>
<li>p55 步骤五 查看根桥信息的命令遗漏”root“，应为”dis stp root“，<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/-1069272936/1984907096/351986724.htm?-430817875">查看文档</a>。</li>
<li>p63 步骤四 接口”G1/0“，应为”G0/1“。</li>
<li>p91 步骤四 配置RTA的密码验证中多输入了一个“simple”，<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/1259698959/867423690/-768537066.htm?-947553691">查看文档</a>。</li>
<li>p92 第一行进入端口G0/1的命令错误，可为“interface GigabitEthernet 0/1”</li>
<li>p120 apply default-next-hop命令用来设置指导报文转发的缺省下一跳时”apply”后缺少减号“-”。<ul>
<li>apply default-next-hop命令用来设置指导报文转发的缺省下一跳，<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/1259698959/-674650488/1092155511.htm?136921610">查看文档</a>；</li>
<li>apply next-hop命令用来设置报文转发的下一跳，<a target="_blank" rel="noopener" href="https://wenoif.github.io/hcl/hcl-cmd-help/1259698959/-674650488/1092155511.htm?-1850744860">查看文档</a>。</li>
</ul>
</li>
</ul>
<h3 id="1-VLAN-配置"><a href="#1-VLAN-配置" class="headerlink" title="1.VLAN 配置"></a>1.VLAN 配置</h3><h4 id="基于MAC地址"><a href="#基于MAC地址" class="headerlink" title="基于MAC地址"></a>基于MAC地址</h4><p>三种链路端口：<br>access：只允许默认VLAN的以太网帧通过的端口称为access链路类型端口，收到帧时打上标签，转发出帧时剥离标签，通常用在单交换机环境中；<br>trunk：可以接收发送多个VLAN的帧，转发过程中不对帧标签进行操作，默认VLAN的帧除外，对于默认VLAN其执行过程同access端口，通常用在跨交换机环境中；<br>hybrid：可以接收发送多个VLAN的帧，同时还能够对指定VLAN进行标签剥离。<br>标签：交换机根据数据帧中的标签判定属于哪一个VLAN；<br>默认VLAN：是指端口所属的VLAN，又称为PVID（Port VLAN ID）。</p>
<p>基于MAC的VLAN是根据报文的源MAC地址来划分VLAN。设备维护的MAC VLAN表记录了MAC地址和VLAN的对应关系。这种划分方法的最大优点就是当用户物理位置发生变化，VLAN不用重新配置。所以这种根据MAC地址的划分方法也称为基于用户的VLAN。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00101%E5%9F%BA%E4%BA%8EMAC%E5%9C%B0%E5%9D%80%E7%9A%84VLAN%E9%85%8D%E7%BD%AE-%E6%AD%A5%E9%AA%A44.png" alt="00101基于MAC地址的VLAN配置-步骤4"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00101%E5%9F%BA%E4%BA%8EMAC%E5%9C%B0%E5%9D%80%E7%9A%84VLAN%E9%85%8D%E7%BD%AE-%E6%AD%A5%E9%AA%A45.png" alt="00101基于MAC地址的VLAN配置-步骤5"></p>
<p>SWA配置如下，SWB类似</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 创建vlan</span><br><span class="line">[SWA]vlan 10</span><br><span class="line">[SWA]vlan 20</span><br><span class="line"></span><br><span class="line"># 将mac地址添加进vlan</span><br><span class="line">[SWA]mac-vlan mac-address 1a87-0d78-0306 vlan 10</span><br><span class="line">[SWA]mac-vlan mac-address 1a87-11e8-0406 vlan 20</span><br><span class="line"></span><br><span class="line"># 将连接PC的端口设置为Hybrid端口，指定允许通过的VLAN及是否剥离标签，开启mac-vlan服务</span><br><span class="line">[SWA]interface GigabitEthernet 1&#x2F;0&#x2F;1</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port link-type hybrid</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port hybrid vlan 10 20 untagged</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]mac-vlan enable</span><br><span class="line"></span><br><span class="line">[SWA]interface GigabitEthernet 1&#x2F;0&#x2F;2</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port link-type hybrid </span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port hybrid vlan 10 20 untagged </span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]mac-vlan enable</span><br><span class="line"></span><br><span class="line"># 将连接另一台交换机的端口设置为trunk端口，指定允许通过的VLAN</span><br><span class="line">[SWA]interface GigabitEthernet 1&#x2F;0&#x2F;24</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]port link-type trunk</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]port trunk permit vlan 10 20</span><br></pre></td></tr></table></figure>







<h4 id="基于协议"><a href="#基于协议" class="headerlink" title="基于协议"></a>基于协议</h4><p>基于协议的VLAN（简称协议VLAN）是根据端口接收到的报文所属的协议（族）类型以及封装格式来给报文分配不同的VLAN ID。可用来划分VLAN的协议有IP、IPX、AT（AppleTalk，Apple计算机网络协议）等，封装格式有Ethernet II、802.3 raw、802.2 LLC、802.2 SNAP等。</p>
<p>协议VLAN由协议模板定义。协议模板是用来匹配报文所属协议类型的标准，由“协议类型＋封装格式”组成。对于一个协议VLAN来说，其绑定的多个协议模板用协议索引（<em>protocol-index</em>）来区分；对于不同的协议VLAN来说，其绑定的协议模板用协议<em>vlan-id</em>和<em>protocol-index</em>来唯一标识。最后通过命令行将协议VLAN中的协议模板与端口绑定。</p>
<p>当端口收到Untagged报文时，如果该报文携带的协议类型和封装格式与某协议模板相匹配，则为其添加该协议模板绑定的协议<em>vlan-id</em>的VLAN Tag，否则为其添加PVID的VLAN Tag。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00102%E5%9F%BA%E4%BA%8E%E5%8D%8F%E8%AE%AE%E7%9A%84VLAN%E9%85%8D%E7%BD%AE.png" alt="00102基于协议的VLAN配置"></p>
<p>SWA配置如下，SWB类似</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 创建VLAN 并配置VLAN与指定的协议模板关联</span><br><span class="line">[SWA]vlan 10</span><br><span class="line">[SWA-vlan10]protocol-vlan ipv4</span><br><span class="line">[SWA-vlan10]vlan 20</span><br><span class="line">[SWA-vlan20]protocol-vlan ipv6</span><br><span class="line"></span><br><span class="line"># 将连接PC的端口设置为Hybrid端口，指定允许通过的VLAN及是否剥离标签，将VLAN协议和模板绑定</span><br><span class="line">[SWA-vlan20]interface GigabitEthernet 1&#x2F;0&#x2F;1</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port link-type hybrid</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port hybrid vlan 10 20 untagged</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port hybrid protocol-vlan vlan 10 0</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port hybrid protocol-vlan vlan 20 0</span><br><span class="line"></span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]interface GigabitEthernet 1&#x2F;0&#x2F;2</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port link-type hybrid</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port hybrid vlan 10 20 untagged</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port hybrid protocol-vlan vlan 10 0</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port hybrid protocol-vlan vlan 20 0</span><br><span class="line"></span><br><span class="line"># 将连接另一台交换机的端口设置为trunk端口，指定允许通过的VLAN</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]interface GigabitEthernet 1&#x2F;0&#x2F;24</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]port link-type trunk</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]port trunk permit vlan 10 20</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="基于IP子网"><a href="#基于IP子网" class="headerlink" title="基于IP子网"></a>基于IP子网</h4><p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00103%E5%9F%BA%E4%BA%8EIP%E5%AD%90%E7%BD%91%E7%9A%84VLAN%E9%85%8D%E7%BD%AE-%E6%AD%A5%E9%AA%A43.png" alt="00103基于IP子网的VLAN配置-步骤3"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00103%E5%9F%BA%E4%BA%8EIP%E5%AD%90%E7%BD%91%E7%9A%84VLAN%E9%85%8D%E7%BD%AE-%E6%AD%A5%E9%AA%A44.png" alt="00103基于IP子网的VLAN配置-步骤4"></p>
<p>SWA配置如下，SWB类似</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 创建VLAN 并配置VLAN与指定得IP子网关联</span><br><span class="line">[SWA]vlan 10</span><br><span class="line">[SWA-vlan10]ip-subnet-vlan ip 10.10.10.0 255.255.255.0</span><br><span class="line">[SWA-vlan10]vlan 20</span><br><span class="line">[SWA-vlan20]ip-subnet-vlan ip 20.20.20.0 255.255.255.0</span><br><span class="line"></span><br><span class="line"># 将连接PC的端口设置为Hybrid端口，指定允许通过的VLAN及是否剥离标签，将端口与IP子网关联</span><br><span class="line">[SWA-vlan20]interface GigabitEthernet 1&#x2F;0&#x2F;1</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port link-type hybrid</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port hybrid vlan 10 20 untagged</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port hybrid ip-subnet-vlan vlan 10</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]port hybrid ip-subnet-vlan vlan 20</span><br><span class="line"></span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]interface GigabitEthernet 1&#x2F;0&#x2F;2</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port link-type hybrid</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port hybrid vlan 10 20 untagged</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port hybrid ip-subnet-vlan vlan 10</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]port hybrid ip-subnet-vlan vlan 20</span><br><span class="line"></span><br><span class="line"># 将连接另一台交换机的端口设置为trunk端口，指定允许通过的VLAN</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;2]interface GigabitEthernet 1&#x2F;0&#x2F;24</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]port link-type trunk</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]port trunk permit vlan 10 20</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="2-GVRP"><a href="#2-GVRP" class="headerlink" title="2.GVRP"></a>2.GVRP</h3><p>GVRP，通用VLAN注册协议，是一种公有协议。 主要是用于在交换机之间自动同步 VLAN 信息，确保交换机上 VLAN 信息数据库的一致</p>
<h4 id="GVRP基本配置"><a href="#GVRP基本配置" class="headerlink" title="GVRP基本配置"></a>GVRP基本配置</h4><p>先两侧交换机上配置基于端口的VLAN，三个交换机设置为trunk端口，两侧交换机能否互通？不能，故要配置GVRP。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00201GVRP-%E6%AD%A5%E9%AA%A44%E9%85%8D%E7%BD%AEGVRP%E4%B9%8B%E5%89%8D.png" alt="00201GVRP-步骤4配置GVRP之前"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00201GVRP-%E6%AD%A5%E9%AA%A45%E9%85%8D%E7%BD%AEGVRP%E4%B9%8B%E5%90%8E.png" alt="00201GVRP-步骤5配置GVRP之后"></p>
<p>配置基于端口的VLAN和trunk端口：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 配置基于端口的VLAN</span><br><span class="line">[SWA]vlan 10</span><br><span class="line">[SWA-vlan10]port GigabitEthernet 1&#x2F;0&#x2F;1</span><br><span class="line"></span><br><span class="line"># 配置端口为trunk 允许所有VLAN通过</span><br><span class="line">[SWA-vlan10]interface GigabitEthernet 1&#x2F;0&#x2F;24</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]port link-type trunk</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]port trunk permit vlan all</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置GVRP：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 在系统视图开启GVRP，然后在每一个 Trunk 端口启用 GVRP 协议</span><br><span class="line">[SWA]mvrp gvrp-compliance enable</span><br><span class="line">[SWA]mvrp global enable</span><br><span class="line"></span><br><span class="line">[SWA]interface GigabitEthernet 1&#x2F;0&#x2F;24</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;24]mvrp enable</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="GVRP-端口注册模式配置"><a href="#GVRP-端口注册模式配置" class="headerlink" title="GVRP 端口注册模式配置"></a>GVRP 端口注册模式配置</h4><p>接口模式下：gvrp registration { fixed | forbidden | normal }，配置GVRP接口注册模式。配置GVRP接口注册模式之前，需要先使能接口的GVRP功能。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00202GVRP%E7%AB%AF%E5%8F%A3%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%BC%8F-%E6%AD%A5%E9%AA%A42.png" alt="00202GVRP端口注册模式-步骤2"></p>
<p>GVRP的接口注册模式有三种：<br>Normal模式：允许该接口动态注册、注销VLAN，传播动态VLAN以及静态VLAN信息。<br>Fixed模式：禁止该接口动态注册、注销VLAN，只传播静态VLAN信息，不传播动态VLAN信息。也就是说被设置为Fixed模式的Trunk接口，即使允许所有VLAN通过，实际通过的VLAN也只能是手动创建的那部分。<br>Forbidden模式：禁止该接口动态注册、注销VLAN，不传播除VLAN1以外的任何的VLAN信息。也就是说被配置为Forbidden模式的Trunk接口，即使允许所有VLAN通过，实际通过的VLAN也只能是VLAN1。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00202GVRP%E7%AB%AF%E5%8F%A3%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%BC%8F-%E6%AD%A5%E9%AA%A43fixed%E6%A8%A1%E5%BC%8F.png" alt="00202GVRP端口注册模式-步骤3fixed模式"></p>
<h3 id="3-Isolate-user-vlan"><a href="#3-Isolate-user-vlan" class="headerlink" title="3.Isolate-user-vlan"></a>3.Isolate-user-vlan</h3><p>随着以太网技术的快速发展，很多运营商采用LAN接入小区宽带。基于用户安全和管理计费等方面的考虑，运营商一般要求接入用户相互隔离。VLAN是天然的隔离手段，但是根据 IEEE 802.1Q 协议规定，设备最大可使用的VLAN资源为4096个。对于运营商的设备来说，如果每个用户一个VLAN，4094个VLAN（0-4095，实际可用为1-4094）远远不够，而且，为每个只包含一个用户的VLAN配置第三层接口，将耗费大量的IP地址和部署成本。为了解决上述问题，isolate-user-vlan技术应运而生。</p>
<p>Isolate-user-vlan采用二层VLAN接口，它在同一台设备上设置 Isolate-user-vlan 和 Secondary VLAN 两类VLAN。理论上每个 Isolate-user-vlan 可以包含4094个 Secondary VLAN ，所以相当于提供了 4094 X 4094 个VLAN（ 16760836 ）。</p>
<p>Isolate-user-vlan 用于上行连接，不同的 Secondary VLAN 关联到同一个 Isolate-user-vlan 。上行连接的设备只知道 Isolate-user-vlan ，而不必关心 Secondary VLAN ，简化了网络配置，节省了VLAN资源。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00301Isolate-user-vlan%E6%AD%A5%E9%AA%A42.png" alt="00301Isolate-user-vlan步骤2"></p>
<p>Secondary VLAN 用于连接用户，Secondary VLAN 之间二层帧相互隔离。如果希望实现同一Isolate-user-vlan 下 Secondary VLAN 用户之间的互通，可以通过配置上行设备的本地代理ARP功能来实现三层报文的互通。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00301Isolate-user-vlan%E6%AD%A5%E9%AA%A44.png" alt="00301Isolate-user-vlan步骤4"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 创建VLAN 加入指定端口，私有VLAN指定主机模式</span><br><span class="line">[SWA]vlan 2</span><br><span class="line">[SWA-vlan2]port GigabitEthernet 1&#x2F;0&#x2F;1</span><br><span class="line">[SWA-GigabitEthernet 1&#x2F;0&#x2F;1] port private-vlan host</span><br><span class="line"></span><br><span class="line">[SWA]vlan 3 </span><br><span class="line">[SWA-vlan3]port GigabitEthernet 1&#x2F;0&#x2F;2</span><br><span class="line">[SWA-GigabitEthernet 1&#x2F;0&#x2F;2] port private-vlan host</span><br><span class="line"></span><br><span class="line"># 创建vlan，配置为主VLAN，指定辅助vlan 2 3，将私有VLAN端口类型设置为杂合端口Promiscuous</span><br><span class="line">[SWA]vlan 10</span><br><span class="line">[SWA-vlan10]private-vlan primary</span><br><span class="line">[SWA-vlan10]private-vlan secondary 2 3</span><br><span class="line">[SWA-vlan10]int GigabitEthernet 1&#x2F;0&#x2F;3</span><br><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;3] port private-vlan 10 promiscuous</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>私有VLAN（PVLAN）端口类型：<br>杂合端口（Promiscuous）：与所有VLAN中的端口通信，包括团体端口和孤立端口。一般是连接路由器端口、备份或共享服务器端口或者VLAN接口。<br>孤立端口（Isolated）：与同一个主VLAN中的其他端口隔离，只能与杂合端口进行通信。<br>团体端口（Community）：同一团体VLAN中的团体端口之间可以进行通信，也可和杂合端口通信。不同团体VLAN中的端口不能通信。</p>
<p>如果要使两个Secondary VLAN互通，可以通过配置上行设备的本地代理ARP功能来实现三层报文的互通。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[SWB]interfaceVlan-interface 20</span><br><span class="line">[SWB-Vlan-interface20]local-proxy-arp enable</span><br></pre></td></tr></table></figure>







<h4 id="Super-VLAN"><a href="#Super-VLAN" class="headerlink" title="Super VLAN"></a>Super VLAN</h4><p>在大型局域网组网中，常采用接入层和核心层二层结构的组网方式，所有的网关都设在核心层设备上。由于每个VLAN都需要一个接口实现路由互通，这样问题就来了，如果因为特殊的需要，网络中划分了成百上千个VLAN，此时核心层设备就会出现VLAN接口数量不足的情况。那么，如果拥有一种技术，可以对VLAN进行聚合，就可以大幅度缩减实际需要的VLAN接口数量，交换机支持VLAN接口少的问题就可以得到解决。为了解决上面的问题，Super VLAN技术出现了。</p>
<p>super VLAN技术引入Super VLAN和Sub VLAN两个概念。</p>
<p>Super VLAN和通常意义上的VLAN不同，它不包含任何物理接口（通常意义上的VLAN必须依赖于自身物理接口的UP），可以把它看作一个逻辑的三层概念。可以把它看作是若干Sub VLAN的集合，为Sub VLAN提供三层转发。它依赖于所包含的Sub VLAN中存在UP状态的物理接口。</p>
<p>Sub VLAN只能包含物理接口，不能建立三层VLAN接口。它与外部的三层通信靠Super VLAN的接口来实现。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 创建VLAN 并按端口划分</span><br><span class="line">[SWA]vlan 2</span><br><span class="line">[SWA-vlan2]port GigabitEthernet 1&#x2F;0&#x2F;1</span><br><span class="line">[SWA-vlan2]vlan 3</span><br><span class="line">[SWA-vlan3]port GigabitEthernet 1&#x2F;0&#x2F;2</span><br><span class="line"></span><br><span class="line"># 创建VLAN设置为supervlan，指定sub vlan</span><br><span class="line">[SWA-vlan3]vlan 10</span><br><span class="line">[SWA-vlan10]supervlan</span><br><span class="line">[SWA-vlan10]subvlan 2 3</span><br><span class="line">[SWA-vlan10]QUIT</span><br><span class="line"></span><br><span class="line">[SWA]interface vlan 10</span><br><span class="line">[SWA-Vlan-interface10]ip address 10.1.1.1 24</span><br><span class="line">[SWA-Vlan-interface10]local-proxy-arp enable</span><br><span class="line">[SWA-Vlan-interface10]quit</span><br><span class="line"></span><br><span class="line">[SWA]vlan 20</span><br><span class="line">[SWA-vlan20]port GigabitEthernet 1&#x2F;0&#x2F;3</span><br><span class="line">[SWA-vlan20]quit</span><br><span class="line">[SWA-Vlan-interface20]interface vlan 20</span><br><span class="line">[SWA-Vlan-interface20]ip address 20.1.1.1 24</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="4-VLAN-VPN"><a href="#4-VLAN-VPN" class="headerlink" title="4.VLAN VPN"></a>4.VLAN VPN</h3><h4 id="VLAN-VPN-基本配置"><a href="#VLAN-VPN-基本配置" class="headerlink" title="VLAN VPN 基本配置"></a>VLAN VPN 基本配置</h4><p>QinQ是802.1Q in 802.1Q的简称，是基于IEEE 802.1Q技术的一种比较简单的二层VPN（Virtual Private Network，虚拟专用网络）协议。QinQ通过将一层VLAN Tag封装到私网报文上，使其携带两层VLAN Tag穿越运营商的骨干网络（又称公网），从而使运营商能够利用一个VLAN为包含多个VLAN的用户网络提供服务。QinQ最多可以提供4094×4094个VLAN，满足了城域网对VLAN数量的需求。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00401%E5%BC%80%E5%90%AFQinQ%E5%8A%9F%E8%83%BD%E5%89%8D.png" alt="00401开启QinQ功能前"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[SWA-GigabitEthernet1&#x2F;0&#x2F;1]qinq enable</span><br></pre></td></tr></table></figure>

<p>配置QinQ功能后仍不能ping通，参考官网文档和例子后仍不能ping通，疑是HCL模拟器问题。</p>
<p>QinQ官方配置：<a target="_blank" rel="noopener" href="https://www.h3c.com/cn/d_201503/858069_30005_0.htm">https://www.h3c.com/cn/d_201503/858069_30005_0.htm</a> </p>
<p>知了社区帖子1：<a target="_blank" rel="noopener" href="https://zhiliao.h3c.com/questions/dispcont/17380">https://zhiliao.h3c.com/questions/dispcont/17380</a></p>
<p>知了社区帖子2：<a target="_blank" rel="noopener" href="https://zhiliao.h3c.com/questions/dispcont/49557">https://zhiliao.h3c.com/questions/dispcont/49557</a></p>
<h3 id="5-VLAN-静态路由"><a href="#5-VLAN-静态路由" class="headerlink" title="5.VLAN 静态路由"></a>5.VLAN 静态路由</h3><p><strong>ip route-static</strong>命令用来配置静态路由。<br><strong>undo ip route-static</strong>命令用来删除已配置的静态路由。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/005VLAN%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1.png" alt="005VLAN静态路由"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ip route-static dest-address &#123; mask-length | mask &#125; &#123; interface-type interface-number [ next-hop-address ] [ backup-interface interface-type interface-number [ backup-nexthop backup-nexthop-address ] [ permanent ] | bfd &#123; control-packet | echo-packet &#125; | permanent ] | next-hop-address [ bfd control-packet bfd-source ip-address | permanent | track track-entry-number ] | vpn-instance d-vpn-instance-name next-hop-address [ bfd control-packet bfd-source ip-address | permanent | track track-entry-number ] &#125; [ preference preference-value ] [ tag tag-value ] [ description description-text ]</span><br><span class="line"></span><br><span class="line">undo ip route-static dest-address &#123; mask-length | mask &#125; [ interface-type interface-number [ next-hop-address ] | next-hop-address | vpn-instance d-vpn-instance-name next-hop-address ] [ preference preference-value ]</span><br><span class="line"></span><br><span class="line">ip route-static vpn-instance s-vpn-instance-name dest-address &#123; mask-length | mask &#125; &#123; interface-type interface-number [ next-hop-address ] [ backup-interface interface-type interface-number [ backup-nexthop backup-nexthop-address ] [ permanent ] | bfd &#123; control-packet | echo-packet &#125; | permanent ] | next-hop-address [ public ] [ bfd control-packet bfd-source ip-address | permanent | track track-entry-number ] | vpn-instance d-vpn-instance-name next-hop-address [ bfd control-packet bfd-source ip-address | permanent | track track-entry-number ] &#125; [ preference preference-value ] [ tag tag-value ] [ description description-text ]</span><br><span class="line"></span><br><span class="line">undo ip route-static vpn-instance s-vpn-instance-name dest-address &#123; mask-length | mask &#125; [ interface-type interface-number [ next-hop-address ] | next-hop-address [ public ] | vpn-instance d-vpn-instance-name next-hop-address ] [ preference preference-value ]</span><br><span class="line"></span><br><span class="line">ip route-static topology topo-name dest-address &#123; mask | mask-length &#125; &#123; next-hop-address | interface-type interface-number [ next-hop-address [ backup-interface interface-type interface-number backup-nexthop backup-nexthop-address ] ] &#125; [ preference preference-value ] [ tag tag-value ] [ description description-text ]</span><br><span class="line"></span><br><span class="line">undo ip route-static topology topo-name dest-address &#123; mask | mask-length &#125; [ next-hop-address | interface-type interface-number [ next-hop-address ] ] [ preference preference-value ]</span><br></pre></td></tr></table></figure>



<h3 id="6-VLAN间路由"><a href="#6-VLAN间路由" class="headerlink" title="6.VLAN间路由"></a>6.VLAN间路由</h3><p>通过在交换机上划分不同的 VLAN 而使 PC 处于不同 VLAN</p>
<h4 id="传统VLAN间路由"><a href="#传统VLAN间路由" class="headerlink" title="传统VLAN间路由"></a>传统VLAN间路由</h4><p>使用路由器的两个物理接口分别连接到 VLAN2 和 VLAN3。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00601VLAN%E9%97%B4%E8%B7%AF%E7%94%B1-%E7%AB%AF%E5%8F%A3.png" alt="00601VLAN间路由-端口"></p>
<h4 id="单臂路由"><a href="#单臂路由" class="headerlink" title="单臂路由"></a>单臂路由</h4><p>使用路由器的单个物理接口完成 VLAN2 和 VLAN3 之间的通信，即单臂路由。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00602VLAN%E9%97%B4%E8%B7%AF%E7%94%B1-%E5%AD%90%E7%AB%AF%E5%8F%A3.png" alt="00602VLAN间路由-子端口"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 进入子接口</span><br><span class="line">interface GigabitEthernet0&#x2F;0.2</span><br></pre></td></tr></table></figure>



<h4 id="三层交换机"><a href="#三层交换机" class="headerlink" title="三层交换机"></a>三层交换机</h4><p>使用三层交换机完成 VLAN2 和 VLAN3 之间的通信。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/00603VLAN%E9%97%B4%E8%B7%AF%E7%94%B1-%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA.png" alt="00603VLAN间路由-三层交换机"></p>
<h3 id="7-STP"><a href="#7-STP" class="headerlink" title="7.STP"></a>7.STP</h3><p>STP的作用是防止网桥网络中的冗余链路形成环路工作。</p>
<p>STP是Spanning Tree Protocol的缩写，意思是指生成树协议，可应用于计算机网络中树形拓扑结构建立，主要作用是防止网桥网络中的冗余链路形成环路工作。</p>
<p>但某些特定因素会导致STP失败，要排除故障可能非常困难，这取决于网络设计。生成树协议适合所有厂商的网络设备，在配置上和体现功能强度上有所差别，但是在原理和应用效果是一致的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">display stp brief查看 STP 简要信息</span><br><span class="line">display stp root查看根桥角色</span><br><span class="line"></span><br><span class="line">stp global enable命令用来全局开启生成树协议。</span><br><span class="line">undo stp global enable命令用来全局关闭生成树协议</span><br><span class="line"></span><br><span class="line">stp enable命令用来在端口上开启生成树协议。</span><br><span class="line">undo stp enable命令用来在端口上关闭生成树协议。</span><br><span class="line"></span><br><span class="line">stp priority命令用来配置设备的优先级。</span><br><span class="line">undo stp priority命令用来恢复缺省情况。</span><br></pre></td></tr></table></figure>





<p>STP 不但能够阻断冗余链路，并且能够在活动 链路断开时，通过激活被阻断的冗余链路而恢复网络的连通。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/007STP%E5%86%97%E4%BD%99%E7%89%B9%E6%80%A7.png" alt="007STP冗余特性"></p>
<p>在 SWA 上通过命令 display stp brief 查看端口 G1/0/1 的状态. 注意连续执行命令多次进行查看，以能准确看到端口状态的迁移过程. 可知，端口 G1/0/1 从 Discarding 状态先 迁移到 Learning 状态，最后到 Forwarding 状态，STP 收敛速度是比较慢的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/007STP%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96.png" alt="007STP状态变化"></p>
<h3 id="8-RSTP"><a href="#8-RSTP" class="headerlink" title="8.RSTP"></a>8.RSTP</h3><p>快速生成树协议（Rapid Spanning Tree Protocol ，RSTP） 用于在局域网中消除数据链路层物理环路，其核心是快速生成树算法。RSTP由IEEE 802.1D-1998标准定义的STP（Spanning Tree Protocol，生成树协议）改进而来，最早在IEEE 802.1W-2001中提出，并且在IEEE 802.1D-2004标准中替代了原来的STP协议。RSTP完全向下兼容STP协议，除了和传统的STP协议一样具有避免回路、动态管理冗余链路的功能外，RSTP极大的缩短了拓扑收敛时间，在理想的网络拓扑规模下，所有交换设备均支持RSTP协议且配置得当时，拓扑发生变化（链路UP/DOWN）后恢复稳定的时间可以控制在秒级，而传统的拓扑稳定且能正常工作所需时间为50秒。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stp mode rstp配置生成树协议的模式为rstp</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/008RSTP.png" alt="008RSTP"></p>
<h3 id="9-MSTP"><a href="#9-MSTP" class="headerlink" title="9.MSTP"></a>9.MSTP</h3><p><a target="_blank" rel="noopener" href="http://www.h3c.com/cn/d_200911/922204_30005_0.htm">H3C：MSTP–多生成树协议</a></p>
<p>前面提到的STP/RSTP协议以及Cisco的私有协议PVST+都属于单生成树（SST）协议，也就是对于支持多vlan的设备只能运行单一的生成树。MSTP是IEEE 802.1s中提出的一种STP和VLAN结合使用的新协议，它既继承了RSTP端口快速迁移的优点，又解决了RSTP中不同vlan必须运行在同一棵生成树上的问题。</p>
<p> <img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/009MSTP.png" alt="009MSTP"></p>
<h3 id="10-1静态ECMP"><a href="#10-1静态ECMP" class="headerlink" title="10.1静态ECMP"></a>10.1静态ECMP</h3><p>ECMP：等价多路径路由Equal Cost Multi-path存在多条不同链路到达同一目的地址的网络环境中，是一种网络术语。</p>
<p>ECMP存在多条不同链路到达同一目的地址的网络环境中，如果使用传统的路由技术，发往该目的地址的数据包只能利用其中的一条链路，其它链路处于备份状态或无效状态，并且在动态路由环境下相互的切换需要一定时间，而等值多路径路由协议可以在该网络环境下同时使用多条链路，不仅增加了传输带宽，并且可以无时延无丢包地备份失效链路的数据传输。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01001%E9%9D%99%E6%80%81ECMP.png" alt="01001静态ECMP"></p>
<p>ECMP最大的特点是实现了等值情况下，多路径负载均衡和链路备份的目的，在静态路由和OSPF中基本上都支持ECMP功能。</p>
<h3 id="10-2浮动静态路由"><a href="#10-2浮动静态路由" class="headerlink" title="10.2浮动静态路由"></a>10.2浮动静态路由</h3><p>浮动静态路由是一种特殊的静态路由，通过配置一个比主路由的管理距离更大的静态路由，保证网络中主路由失效的情况下，提供备份路由。但在主路由存在的情况下它不会出现在路由表中。浮动静态路由主要用于拔号备份。</p>
<p>RIP(Routing Information Protocol,路由信息协议）是一种内部网关协议（IGP），是一种动态路由选择协议，用于自治系统（AS）内的路由信息的传递。RIP协议基于距离矢量算法（DistanceVectorAlgorithms），使用“跳数”(即metric)来衡量到达目标地址的路由距离。这种协议的路由器只关心自己周围的世界，只与自己相邻的路由器交换信息，范围限制在15跳(15度)之内，再远，它就不关心了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01002%E6%B5%AE%E5%8A%A8%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1.png" alt="01002浮动静态路由"></p>
<p>配置一条静态路由，配置rip协议，优先选择优先级小的协议，当一个协议挂了以后会自动切换另外一个协议。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rip [ process-id ] [ vpn-instance vpn-instance-name ] 命令用来启动RIP，并进入RIP视图。</span><br><span class="line"></span><br><span class="line">undo rip [ process-id ]命令用来关闭RIP。</span><br></pre></td></tr></table></figure>





<h3 id="11-OSPF"><a href="#11-OSPF" class="headerlink" title="11.OSPF"></a>11.OSPF</h3><p><strong>开放式最短路径优先</strong></p>
<p>开放式最短路径优先（Open Shortest Path First，OSPF）是广泛使用的一种动态路由协议，它属于链路状态路由协议，具有路由变化收敛速度快、无路由环路、支持变长子网掩码（VLSM）和汇总、层次区域划分等优点。在网络中使用OSPF协议后，大部分路由将由OSPF协议自行计算和生成，无须网络管理员人工配置，当网络拓扑发生变化时，协议可以自动计算、更正路由，极大地方便了网络管理。</p>
<p><strong>区域划分</strong></p>
<p>当一个大型网络中的路由器都运行OSPF路由协议时，路由器数量的增多会导致LSDB非常庞大，占用大量的存储空间，并使得运行SPF算法的复杂度增加，导致CPU负担很重。</p>
<p>在网络规模增大之后，拓扑结构发生变化的概率也增大，网络会经常处于“振荡”之中，造成网络中会有大量的OSPF协议报文在传递，降低了网络的带宽利用率。更为严重的是，每一次变化都会导致网络中所有的路由器重新进行路由计算。</p>
<p>OSPF协议通过将自治系统划分成不同的区域（Area）来解决上述问题。区域是从逻辑上将路由器划分为不同的组，每个组用区域号（Area ID）来标识。区域的边界是路由器，而不是链路。一个网段（链路）只能属于一个区域，或者说每个运行OSPF的接口必须指明属于哪一个区域。</p>
<p><strong>骨干区域</strong></p>
<p>OSPF划分区域之后，并非所有的区域都是平等的关系。其中有一个区域是与众不同的，它的区域号（Area ID）是0，通常被称为骨干区域。骨干区域负责区域之间的路由，非骨干区域之间的路由信息必须通过骨干区域来转发。</p>
<p><strong>路由类型</strong></p>
<p>OSPF将路由分为四类，按照优先级从高到低的顺序依次为：<br>区域内路由（Intra Area）<br>区域间路由（Inter Area）<br>第一类外部路由（Type1 External）<br>第二类外部路由（Type2 External）</p>
<p>区域内和区域间路由描述的是AS内部的网络结构，外部路由则描述了应该如何选择到AS以外目的地址的路由。OSPF将引入的AS外部路由分为两类：Type1和Type2。</p>
<p>第一类外部路由是指接收的是IGP（Interior Gateway Protocol，内部网关协议）路由（例如静态路由和RIP路由）。由于这类路由的可信程度较高，并且和OSPF自身路由的开销具有可比性，所以到第一类外部路由的开销等于本路由器到相应的ASBR的开销与ASBR到该路由目的地址的开销之和。</p>
<p>第二类外部路由是指接收的是EGP（Exterior Gateway Protocol，外部网关协议）路由。由于这类路由的可信度比较低，所以OSPF协议认为从ASBR到自治系统之外的开销远远大于在自治系统之内到达ASBR的开销。所以计算路由开销时将主要考虑前者，即到第二类外部路由的开销等于ASBR到该路由目的地址的开销。如果计算出开销值相等的两条路由，再考虑本路由器到相应的ASBR的开销。</p>
<h4 id="单区域OSPF基本配置"><a href="#单区域OSPF基本配置" class="headerlink" title="单区域OSPF基本配置"></a>单区域OSPF基本配置</h4><p>单区域含义：整个链路中，所有开启了OSPF协议的路由器都处在同一区域中。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01101%E5%8D%95%E5%8C%BA%E5%9F%9F%20OSPF%20%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE.png" alt="01101单区域 OSPF 基本配置"></p>
<h4 id="单区域OSPF增强配置"><a href="#单区域OSPF增强配置" class="headerlink" title="单区域OSPF增强配置"></a>单区域OSPF增强配置</h4><p>使用双链路，运行OSPF，在等价路由时修改接口cost来实现哪条链路优先。</p>
<h4 id="多区域OSPF基本配置"><a href="#多区域OSPF基本配置" class="headerlink" title="多区域OSPF基本配置"></a>多区域OSPF基本配置</h4><p>多区域含义：整个链路中，所有开启了OSPF协议的路由器分别处在多个不同的区域中</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01103%E5%A4%9A%E5%8C%BA%E5%9F%9FOSPF%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE.png" alt="01103多区域OSPF基本配置"></p>
<h3 id="12-OSPF路由聚合"><a href="#12-OSPF路由聚合" class="headerlink" title="12.OSPF路由聚合"></a>12.OSPF路由聚合</h3><p><strong>路由聚合</strong></p>
<p>路由聚合是指ABR或ASBR将具有相同前缀的路由信息聚合，只发布一条路由到其它区域。AS被划分成不同的区域后，区域间可以通过路由聚合来减少路由信息，减小路由表的规模，提高路由器的运算速度。OSPF有两类聚合：ABR聚合、ASBR聚合。</p>
<p><strong>路由器的类型</strong></p>
<ul>
<li>区域内路由器（Internal Router）：该类路由器的所有接口都属于同一个OSPF区域。</li>
<li>ABR区域边界路由器（Area Border Router）：该类路由器可以同时属于两个以上的区域，但其中一个必须是骨干区域，用来连接骨干区域和非骨干区域，它与骨干区域之间既可以是物理连接，也可以是逻辑上的连接。</li>
<li>骨干路由器（Backbone Router）：该类路由器至少有一个接口属于骨干区域。因此，所有的ABR和位于Area0的内部路由器都是骨干路由器。</li>
<li>ASBR自治系统边界路由器：与其他AS交换路由信息的路由器称为ASBR。ASBR并不一定位于AS的边界，它有可能是区域内路由器，也有可能是ABR。只要一台OSPF路由器引入了外部路由的信息，它就成为ASBR。</li>
</ul>
<p><strong>查看设备路由时，路由协议类型o_intra和o_ase2有什么区别？</strong></p>
<p>O_INTRA 域内路由<br>o_ase2 : OSPF external type 2 ：类型2的外部路由</p>
<p><strong>OSPF共有两类外部路由：</strong></p>
<p>第一类外部路由的AS外部开销被认为和AS内部开销值是同一数量级的，因此第一类外部路由的开销值为AS内部开销值（路由器到ASBR的开销）与AS外部开销值之和；<br>第二类外部路由的AS外部开销值被认为远大于AS内部开销值，因此第二类外部路由的开销值只是AS外部开销值，忽略AS内部开销值。<br>第一类外部路由永远比第二类外部路由优先，VRP中引入的外部路由类型缺省为第二类。</p>
<h4 id="ABR聚合"><a href="#ABR聚合" class="headerlink" title="ABR聚合"></a>ABR聚合</h4><p>ABR向其它区域发送路由信息时，以网段为单位生成Type3 LSA。如果该区域中存在一些连续的网段，则可以将这些连续的网段聚合成一个网段。这样ABR只发送一条聚合后的LSA，所有属于聚合网段范围的LSA将不再会被单独发送出去，这样可减少其它区域中LSDB的规模。</p>
<p><strong>Loopback接口</strong></p>
<p>Loopback接口是虚拟接口，是一种纯软件性质的虚拟接口。 任何送到该接口的网络数据报文都会被认为是送往设备自身的。 大多数平台都支持使用这种接口来模拟真正的接口。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[H3C-ospf-1-area-0.0.0.1]abr-summary 192.168.0.0 255.255.252.0   开启abr聚合</span><br><span class="line"></span><br><span class="line">[H3C-ospf-1-area-0.0.0.1]abr-summary 192.168.0.0 255.255.252.0 not-advertise 配置了 not-advertise 选项的汇总路由将不会通告出去，同时汇总路由下的明细路由也不会通告出去</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>在ABR（RTB）上配置路由聚合之前，RTC的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0120101ABR%E8%81%9A%E5%90%88%E5%89%8D.png" alt="0120101ABR聚合前"></p>
<p>在ABR（RTB）上配置路由聚合之后，RTC的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0120102ABR%E8%81%9A%E5%90%88%E5%90%8E.png" alt="0120102ABR聚合后"></p>
<p>在ABR（RTB）上配置路由聚合并设置汇总路由不通告功能后，RTC的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0120103ABR%E8%81%9A%E5%90%88%E5%90%8E%E4%B8%8D%E9%80%9A%E5%91%8A.png" alt="0120103ABR聚合后不通告"></p>
<h4 id="ASBR聚合"><a href="#ASBR聚合" class="headerlink" title="ASBR聚合"></a>ASBR聚合</h4><p>配置引入路由聚合后，如果本地路由器是自治系统边界路由器ASBR，将对引入的聚合地址范围内的Type5 LSA进行聚合。当配置了NSSA区域时，还要对引入的聚合地址范围内的Type7 LSA进行聚合。</p>
<p>如果本地路由器是ABR，则对由Type7 LSA转化成的Type5 LSA进行聚合处理。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[H3C-ospf-1]asbr-summary 192.168.0.0 255.255.248.0   开启abr聚合</span><br><span class="line">[H3C-ospf-1]asbr-summary 192.168.0.0 255.255.248.0 not-advertise 配置了 not-advertise 选项的汇总路由将不会通告出去，同时汇总路由下的明细路由也不会通告出去</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<p>在ASBR（RTA）上配置路由聚合之前，RTC的路由表：<br>（在进行ASBR聚合前 需要先完成ABR聚合，否则在RTC路由表中会显示协议类型为“O_INTRA 域内路由”，即需要在完成ABR聚合的基础上进行ASBR聚合）</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0120201ASBR%E8%81%9A%E5%90%88%E5%89%8D.png" alt="0120201ASBR聚合前"></p>
<p>在ASBR（RTA）上配置路由聚合之后，RTC的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0120202ASBR%E8%81%9A%E5%90%88%E5%90%8E.png" alt="0120202ASBR聚合后"></p>
<p>在ASBR（RTA）上配置路由聚合并设置汇总路由不通告功能后，RTC的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0120203ABR%E8%81%9A%E5%90%88%E5%90%8E%E4%B8%8D%E9%80%9A%E5%91%8A.png" alt="0120203ABR聚合后不通告"></p>
<h3 id="13-OSPF-Stub区域和NSSA区域"><a href="#13-OSPF-Stub区域和NSSA区域" class="headerlink" title="13. OSPF Stub区域和NSSA区域"></a>13. OSPF Stub区域和NSSA区域</h3><p>对于OSPF各区域，可分为两种类型：<br>传输区域：除了承载本区域发起的流量和访问本区域的流量外，还承载了源IP和目的IP都不属于本区域的流量，即“穿越型流量”。<br>末端区域：只承载本区域发起的流量和访问本区域的流量。</p>
<p><strong>OSPF LSA</strong></p>
<p>LSA（链路状态通告）是链接状态协议使用的一个分组，它包括有关邻居和通道成本的信息。 LSA被路由器接收用于维护它们的路由选择表。 LSA: Link-State Advertisement。</p>
<p>OSPF V2版本中常用的主要有6类LSA</p>
<ul>
<li>Type 1：Router-LSA：每个设备都会产生，描述了设备的链路状态和开销，在所属的区域内传播。</li>
<li>Type 2：Network-LSA：由DR（Designated Router）产生，描述本网段的链路状态，在所属的区域内传播。</li>
<li>Type 3:Network-summary-LSA：由ABR产生，描述区域内某个网段的路由，并通告给发布或接收此LSA的非Totally STUB或NSSA区域。完全末梢区域是不存在3类LSA的，NSSA区域没有5类和3类LSA，多了7类LSA。</li>
<li>Type 4:ASBR-summary-LSA：由ABR产生，描述到ASBR的路由，通告给除ASBR所在区域的其他相关区域。</li>
<li>Type 5:AS-External-LSA：由ASBR产生，描述到AS外部的路由，通告到所有的区域（除了STUB区域和NSSA区域）。</li>
<li>Type 7:NSSA-LSA：由ASBR产生，描述到AS外部的路由，仅在NSSA区域内传播。Type7 LSA由NSSA区域的自治域边界路由器（ASBR）产生，其扩散范围仅限于ASBR所在的NSSA区域。NSSA区域的区域边界路由器（ABR）收到Type7 LSA时，会有选择地将其转化为Type5 LSA，以便将外部路由信息通告到OSPF网络的其它区域。</li>
</ul>
<h4 id="Stub区域"><a href="#Stub区域" class="headerlink" title="Stub区域"></a>Stub区域</h4><p>Stub区域是一个末梢区域，当一个OSPF区域处于整个自治系统边界时，而又不含其他路由协议，这时就可以配置OSPF Stub区域。</p>
<p>当配置OSPF Stub区域后，Stub区域中的路由器会增加一条至ABR的默认路由条目，当在ABR上配置了完全末梢区域后，末梢区域的其他路由器的路由条目除了直连的路由条目外，只有一条到达ABR的路由条目默认路由，不会学习其他区域的路由条目，到其他区域的数据包通过ABR转发。</p>
<p>因为Stub区域内的路由器不能注入其它路由协议所产生的路由条目，所以也就不会生成相应的5类LSA，在这些区域中路由器的路由表规模以及路由信息传递的数量都会大大减少。</p>
<p><strong>Totally Stub区域</strong></p>
<p>在配置Stub区域之后，在Stub区域的路由器只包含一类、二类、三类LSA，所以我们可以通俗的理解Stub区域，就是削减四类、五类LSA的。但是在实际的网络中，可能我的网络拓扑非常的大，OSPF区域非常的多，可能三类的LSA也非常多，这导致末端区域的LSDB由于三类LSA的存在还是过大。那么我们可以通过配置Totally Stub区域，进一步缩减三类LSA的条目。</p>
<p>Totally Stub区域既不允许自治系统外部路由（四类、五类LSA）在本区域内传播，也不允许区域间路由（三类LSA）在本区域内传播。Totally Stub区域内的路由器对其他区域及自制系统外部的访问需求是通过本区域ABR所产生的三类LSA缺省路由实现的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[H3C-ospf-1-area-0.0.0.2]stub  设置为stub区域</span><br><span class="line">[H3C-ospf-1-area-0.0.0.2]stub  no-summary  设置为Totally Stub区域，与Stub区域配置的区别在于，在ABR上需要追加no-summary参数。</span><br></pre></td></tr></table></figure>



<p>配置Stub区域前，RTD路由表中存在外部路由和OSPF路由（一类、二类、三类LSA）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0130101Stub%E5%89%8D.png" alt="0130101Stub前"></p>
<p>配置Stub区域后，RTD路由表中不存在外部路由，存在OSPF路由（一类、二类、三类LSA）：<img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0130102Stub%E5%90%8E.png" alt="0130102Stub后"></p>
<p>配置Totally Stub区域后，RTD路由表中不存在外部路由，只存在一类、二类LSA的OSPF路由，不存在三类LSA的OSPF路由：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0130103TotallyStub%E5%90%8E.png" alt="0130103TotallyStub后"></p>
<h4 id="NSSA区域"><a href="#NSSA区域" class="headerlink" title="NSSA区域"></a>NSSA区域</h4><p>OSPF规定STUB区域是不能引入外部路由的，这样可以避免大量外部路由对STUB区域路由器带宽和存储资源的消耗。对于既需要引入外部路由又要避免外部路由带来的资源消耗的场景，STUB区域就不再满足需求了。因此产生了NSSA区域。</p>
<p>NSSA（Not-So-Stubby Area）区域是Stub区域的变形，也是一个末梢区域，只是它取消了不能注入其它路由条目的限制，也就是说，可以引入外部路由。但是这个外部路由可能需要限制在自己的区域内传播，因为5类lsa的传播范围是整个ospf域，所以不能生成5类lsa。如果一定要传播到其它区域，就需要ABR做七/五转换，当Type7 LSA到达NSSA的ABR时，由ABR将7类lsa转换成5类lsa，再传播出去。NSSA区域内的外部路由，仅能以7类lsa的形式存在。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[H3C-ospf-1-area-0.0.0.2]nssa 设置为nssa区域</span><br><span class="line">[H3C-ospf-1-area-0.0.0.2]nssa  no-summary  设置为Totally nssa区域，与nssa区域配置的区别在于，在ABR上需要追加no-summary参数。</span><br><span class="line"></span><br><span class="line">no-summary：该参数只用于NSSA区域的ABR，配置后，ABR只通过Type-3 LSA向区域内发布一条缺省路由，不再向区域内发布任何其它Type-3 LSA（这种区域又称为Totally NSSA区域）。</span><br></pre></td></tr></table></figure>





<p>将Area 2配置成NSSA区域之前，RTD的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0130201NSSA%E5%89%8D.png" alt="0130201NSSA前"></p>
<p>将Area 2配置成NSSA区域之后，RTD的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0130202NSSA%E5%90%8E.png" alt="0130202NSSA后"></p>
<p>将Area 2配置成Totally NSSA区域之后，RTD的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0130203TotallyNSSA%E5%90%8E.png" alt="0130203TotallyNSSA后"></p>
<h3 id="14-OSPF-虚连接和认证配置"><a href="#14-OSPF-虚连接和认证配置" class="headerlink" title="14.OSPF 虚连接和认证配置"></a>14.OSPF 虚连接和认证配置</h3><p><strong>虚连接</strong></p>
<p>虚连接是指在两台ABR之间通过一个非骨干区域而建立的一条逻辑上的连接通道。它的两端必须是ABR，而且必须在两端同时配置方可生效。为虚连接两端提供一条非骨干区域内部路由的区域称为传输区（Transit Area）。</p>
<p>OSPF虚连接不能通过stub区域和NSSA区域。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vlink-peer命令用来创建并配置一条虚连接。</span><br><span class="line"></span><br><span class="line">undo vlink-peer命令用来删除一条已有的虚连接。</span><br></pre></td></tr></table></figure>



<p>进行虚连接之前，RTD的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0140101%E8%99%9A%E8%BF%9E%E6%8E%A5%E4%B9%8B%E5%89%8D.png" alt="0140101虚连接之前"></p>
<p>进行虚连接之后，RTD的路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0140102%E8%99%9A%E8%BF%9E%E6%8E%A5%E4%B9%8B%E5%90%8E.png" alt="0140102虚连接之后"></p>
<p><strong>认证</strong></p>
<p>ospf支持两种认证方式：<br>区域认证：同一区域内的认证模式和口令必须一致<br>链路认证：链路认证相对于区域认证更加灵活，可针对某单独链路进行设置单独的认证模式和密码。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 区域认证</span><br><span class="line">[H3C-ospf-1-area-0.0.0.0]authentication-mode simple plain 123</span><br><span class="line"></span><br><span class="line"># 链路认证</span><br><span class="line">[H3C-GigabitEthernet0&#x2F;0]ospf authentication-mode  simple plain 123</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>配置验证前RTB的OSPF邻居信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0140201%E9%85%8D%E7%BD%AE%E9%AA%8C%E8%AF%81%E5%89%8D.png" alt="0140201配置验证前"></p>
<p>配置验证后RTB的OSPF邻居信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/0140202%E9%85%8D%E7%BD%AE%E9%AA%8C%E8%AF%81%E5%90%8E.png" alt="0140202配置验证后"></p>
<h3 id="15-单区域IS-IS"><a href="#15-单区域IS-IS" class="headerlink" title="15.单区域IS-IS"></a>15.单区域IS-IS</h3><p>由于历史原因，OSI曾经是要比TCP/IP协议栈普及，当现在的TCP/IP流行的时候，以前的采用OSI模型中CLNS（由ISO制定的规范）的应用要和现在的TCP/IP（由IETF进行兼容，可以使网络层为CLNP和为IP的路由信息可以互通，所以需要要有个路由协议来作为这两种情况的兼容点。</p>
<p><strong>中间系统到中间系统</strong>（ISIS-Intermediate system to intermediate system）是一个分级的链接状态路由协议，基于DECnet PhaseV 路由算法，实际上与OSPF非常相似。</p>
<p><strong>IS-IS</strong>：ISO定义的协议栈中无连接网络协议 CLNS 由三个协议CLNP、IS-IS、ES-IS构成，CLNP类似于 TCP/IP 中的 IP 协议；ES-IS：主机系统与中间系统间的协议，就像 IP 中的 ARP，IGMP 协议等；IS-IS：中间系统（路由器）的路由协议，类似于 IP 协议中的 ospf，是OSI 协议栈中唯一一个保留下来的 IGP 协议。</p>
<p><strong>集成IS-IS</strong>：IS-IS创造之初是为了CLNP工作的，但是因为OSI模型的被淘汰，IS-IS经过改进可以兼容IP，改造后的IS-IS被称为集成IS-IS。</p>
<p><strong>名词概念解释</strong></p>
<p><strong>ES-IS、IS-IS</strong>：在ISO规范中，一个路由器就是一个IS（中间系统），一个主机就是一个ES（末端系统）。提供IS和ES（路由器和主机）之间通信的协议，就是ES-IS；提供IS和IS（路由器和路由器）之间通信的协议也就是路由协议，叫IS-IS。</p>
<p><strong>PDU</strong>：Protocol Data Unit，协议数据单元），是在OSI模型中各层之间所传送的数据单元。数据帧就是Data Link PDU；报文就是Packet PDU；相当于OSPF中的LSA就是Link State PDU，但不像LSA，前面还要有OSPF头，IP头，LSP本身就是一个报文，不需要额外的封装。</p>
<p><strong>Area ID</strong>：由于IS-IS路由区域里，一个路由器必须只能属于一个区域，不会象OSPF中一个路由器同时属于多个区域，所以一个Area ID只会和一台路由器产生关系。</p>
<p><strong>System ID</strong>：相当于OSPF路由协议中的Router ID；System ID是不变的，在一个区域中，所有的IS都必须只能有一个System ID，而且System ID的长度必须一直，为6个Octet。一般都是接口的MAC地址。而所有处在相同Area 的路由器都必须有一致的Area ID</p>
<p><strong>Level 1和 Level 2路由器</strong>：首先要明白和OSPF的一个区别，OSPF路由协议的区域边界是以路由器为准，而IS-IS路由协议的区域边界是在链路上的。Level 1路由器是没有直接连接到其他区域的路由器；Level 2路由器是连接不同区域的路由器；</p>
<p>Level 1路由器相当于OSPF中的非骨干区域中的路由器；<br>Level 2路由器相当于OSPF中的骨干区域路由器；</p>
<p>Level 1/Level 2路由器相当于OSPF中的ABR，他必须维护两个不同区域的链路状态表。但是他又不像ABR，他不会把Level 2的路由信息传到Level 1的区域中去。而Level 1区域就相当于OSPF中的完全存根区域，需要把L1/L2路由器作为一个网关，去请求一个去往外区域的路由，L1/L2路由器通过发送LSP报文到L1区域，设置ATT bit让L1区域的路由器知道，发送这个LSP的路由器知道如何去往外区域的路由。</p>
<p>和OSPF的又一个不同：OSPF在区域内采用SPF算法，而区域间路由采用Distance Vector算法来实现；而IS-IS都采用SPF算法来计算路由，因为作为L1/L2路由器他同时维护了两张链路状态表。可以进行SPF计算。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[RTA-isis-1]is-level level-1 设置 RTA 为 level-1</span><br><span class="line">路由器</span><br><span class="line">[RTA-GigabitEthernet0&#x2F;0]isis enable 1 使接口开启ISIS</span><br><span class="line"></span><br><span class="line">display isis 命令来查看 IS-IS 输出信息</span><br><span class="line">display isis peer 命令查看 ISIS 邻居表</span><br><span class="line">display isis lsdb verbose 命令查看 LSDB 数据库</span><br><span class="line"> display isis route 命令查看 ISIS 路由表。</span><br><span class="line">[RTA-isis-1]network-entity 10.0000.0000.0001.00  设置 NET 实体为 10.0000.0000.0001.00</span><br></pre></td></tr></table></figure>



<p>单区域ISIS查看路由表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01501%E5%8D%95%E5%8C%BA%E5%9F%9FISIS%E6%9F%A5%E7%9C%8B%E8%B7%AF%E7%94%B1%E8%A1%A8.png" alt="01501单区域ISIS查看路由表"></p>
<p>单区域ISIS查看邻居信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01502%E5%8D%95%E5%8C%BA%E5%9F%9FISIS%E6%9F%A5%E7%9C%8B%E9%82%BB%E5%B1%85%E4%BF%A1%E6%81%AF.png" alt="01502单区域ISIS查看邻居信息"></p>
<p>单区域ISIS查看LSDB数据库：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01503%E5%8D%95%E5%8C%BA%E5%9F%9FISIS%E6%9F%A5%E7%9C%8BLSDB%E6%95%B0%E6%8D%AE%E5%BA%93.png" alt="01503单区域ISIS查看LSDB数据库"></p>
<h3 id="16-多区域IS-IS、开销值、聚合、认证"><a href="#16-多区域IS-IS、开销值、聚合、认证" class="headerlink" title="16.多区域IS-IS、开销值、聚合、认证"></a>16.多区域IS-IS、开销值、聚合、认证</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cost-style命令用来配置IS-IS开销值的类型，即IS-IS接收和发送的报文中到达目的地路径开销值的类型。</span><br><span class="line">bandwidth-reference命令用来配置IS-IS自动计算链路开销值时依据的带宽参考值。</span><br><span class="line">auto-cost enable命令用来使能自动计算接口链路开销值功能。</span><br><span class="line">address-family ipv4命令用来创建并进入IS-IS IPv4地址族视图。</span><br><span class="line">summary命令用来配置一条聚合路由。</span><br><span class="line">domain-authentication-mode命令用来配置路由域验证方式和验证密码。</span><br><span class="line">reset isis peer命令用来清除IS-IS指定邻居的数据结构信息。</span><br></pre></td></tr></table></figure>



<p>多区域ISIS：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01601%E5%A4%9A%E5%8C%BA%E5%9F%9FISIS.png" alt="01601多区域ISIS"></p>
<p>多区域ISIS开销值：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01602%E5%A4%9A%E5%8C%BA%E5%9F%9FISIS%E5%BC%80%E9%94%80%E5%80%BC.png" alt="01602多区域ISIS开销值"></p>
<p>多区域ISIS聚合前：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01603%E5%A4%9A%E5%8C%BA%E5%9F%9FISIS%E8%81%9A%E5%90%88%E5%89%8D.png" alt="01603多区域ISIS聚合前"></p>
<p>多区域ISIS聚合后：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01604%E5%A4%9A%E5%8C%BA%E5%9F%9FISIS%E8%81%9A%E5%90%88%E5%90%8E.png" alt="01604多区域ISIS聚合后"></p>
<h3 id="17-使用-filter-policy-过滤路由"><a href="#17-使用-filter-policy-过滤路由" class="headerlink" title="17.使用 filter-policy 过滤路由"></a>17.使用 filter-policy 过滤路由</h3><p>filter-policy：过滤策略，该工具主要应用在路由协议的进程中，可以调用ACL、ip-prefix、route-policy 等工具来匹配路由，用于控制对路由的发布或接收，只有通过该策略的路由才可以被发布或者接收,未通过策略的路由则被过滤掉。只能过滤路由，无法过滤LSA，不能修改路由属性。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ip prefix-list命令用来配置一个IPv4地址前缀列表表项。</span><br><span class="line">display ip prefix-list命令用来显示IPv4地址前缀列表的统计信息。</span><br><span class="line">reset ip prefix-list命令用来清除指定的IPv4地址前缀列表的统计信息。</span><br><span class="line">filter-policy命令用来配置EVI IS-IS进程绑定的路由策略。</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>聚合之前：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01701%E8%81%9A%E5%90%88%E4%B9%8B%E5%89%8D.png" alt="01701聚合之前"></p>
<p>聚合之后：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01702%E8%81%9A%E5%90%88%E4%B9%8B%E5%90%8E.png" alt="01702聚合之后"></p>
<p>filter-policy过滤后：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01703filter-policy%E8%BF%87%E6%BB%A4%E5%90%8E.png" alt="01703filter-policy过滤后"></p>
<h3 id="18-使用-Route-policy-控制路由"><a href="#18-使用-Route-policy-控制路由" class="headerlink" title="18.使用 Route-policy 控制路由"></a>18.使用 Route-policy 控制路由</h3><p>Route-policy 用来匹配给定的路由信息或者路由信息的某些属性，并在条件满足时改变这些路由信息的属性。</p>
<p><strong>filter-policy 对比 Route-policy</strong><br>都能对路由进行过滤；<br>Filter-policy只能过滤路由，不能进行其他操作，如：对路由的属性进行更改；<br>Route-policy不仅能对路由进行过滤，而且可以针对具体的路由修改其属性，如cost、tag等。</p>
<p>配置Route-policy前：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01801%E9%85%8D%E7%BD%AERoute-policy%E5%89%8D%20.png" alt="01801配置Route-policy前 "></p>
<p>配置Route-policy后：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01802%E9%85%8D%E7%BD%AERoute-policy%E5%90%8E.png" alt="01802配置Route-policy后"></p>
<p><strong>路由引入技术</strong></p>
<p>网络中由于各种不同的路由协议的度量值和计算方法的差异，不同路由域的路由协议间是无法进行路由学习的，为了解决不同路由域不同路由协议间的路由的学习，提出了路由引入技术，思科网络中将此称之为路由重发布技术。</p>
<p><strong>路由引入的方法</strong>：</p>
<ul>
<li>单边界路由引入是指运行两种不同路由协议的路由域在仅有的一个边界上引入路由的方法。</li>
<li>多边界路由引入是指运行多种不同路由协议的路由域存在多个相互连接的路由边界。</li>
</ul>
<p><strong>引入方法</strong>：<br>单向引入是只只在一个路由域中引入另外的一种路由协议，而不将当前的路由协议产生的路由信息引入到其他的路由域。<br>双向引入是只两种或两种以上的路由协议在两个不同的路由域而分别在两个路由域分别进行路由引入的方法。</p>
<p>一般来说，单边界路由引入不会产生路由环路，但是边界路由器容易产生单点故障，当边界路由器宕机或者链路出现故障的时候会导致两个路由域无法正常通信。</p>
<p>多边界路由引入如果引入不正确将会产生路由环路，但是多边界路由引入不会有单点故障产生，即使边界设备出现故障仍然能够保证正常的通信，一般采取的方法是将其他路由域的的路由引入到当前路由域的时候做标记，从该路由域发布到其他路由域的时候进行路由过滤。使之不要将自己路由域的路由重新发布回来而引起环路。</p>
<p>分别将ospf和rip的路由引入对方前：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01803%E5%8F%8C%E8%BE%B9%E7%95%8C%E5%BC%95%E5%85%A5%E5%89%8D.png" alt="01803双边界引入前"></p>
<p>分别将ospf和rip的路由引入对方后：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01804%E5%8F%8C%E8%BE%B9%E7%95%8C%E5%BC%95%E5%85%A5%E5%90%8E.png" alt="01804双边界引入后"></p>
<p><strong>路由环路</strong></p>
<p>路由环路是指数据包在一系列路由器之间不断传输却始终无法到达其预期目的网络的一种现象。</p>
<p>路由环路产生：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01805%E8%B7%AF%E7%94%B1%E7%8E%AF%E8%B7%AF%E4%BA%A7%E7%94%9F.png" alt="01805路由环路产生"></p>
<p>用tag标记选择性引入路由：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01806%E7%94%A8tag%E6%A0%87%E8%AE%B0%E9%80%89%E6%8B%A9%E6%80%A7%E5%BC%95%E5%85%A5%E8%B7%AF%E7%94%B1.png" alt="01806用tag标记选择性引入路由"></p>
<h3 id="19-使用-PBR-实现策略路由"><a href="#19-使用-PBR-实现策略路由" class="headerlink" title="19.使用 PBR 实现策略路由"></a>19.使用 PBR 实现策略路由</h3><p>PBR（Policy Based Routing, 策略路由）是一种比基于目标网络进行路由更加灵活的数据包路由转发机制，以前是CISCO用来丢弃报文的一个主要手段。比如：设置set interface null 0，按CISCO说法这样会比ACL的deny要节省一些开销。通过在路由器上应用策略路由，使路由器根据路由映射（route-map）决定经过路由器的数据包如何处理。路由映射决定了一个数据包的下一跳转发路由器。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">acl命令用来创建一个ACL，并进入相应的ACL视图。</span><br><span class="line">rule命令用来创建一条规则。</span><br><span class="line"></span><br><span class="line">policy-based-route命令用来创建策略节点，并进入策略节点视图。如果指定的策略节点已创建，则该命令直接用来进入该策略节点的视图。</span><br><span class="line"></span><br><span class="line">if-match acl命令用来设置ACL匹配规则。</span><br><span class="line"></span><br><span class="line">apply output-interface命令用来设置指导报文转发的出接口。</span><br><span class="line"></span><br><span class="line">ip policy-based-route命令用来对接口转发的报文应用策略。</span><br></pre></td></tr></table></figure>



<p>配置PBR之前：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01901%E9%85%8D%E7%BD%AEPBR%E4%B9%8B%E5%89%8D.png" alt="01901配置PBR之前"></p>
<p>配置PBR基于IP地址：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01902%E9%85%8D%E7%BD%AEPBR%E5%9F%BA%E4%BA%8EIP%E5%9C%B0%E5%9D%80.png" alt="01902配置PBR基于IP地址"></p>
<p>配置PBR基于报文长度：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenoif/hexo-html@gh-pages/POSTS/2021-06-04-hcl/01902%E9%85%8D%E7%BD%AEPBR%E5%9F%BA%E4%BA%8E%E6%8A%A5%E6%96%87%E9%95%BF%E5%BA%A6.png" alt="01902配置PBR基于报文长度"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2/">路由交换</a><a class="post-meta__tags" href="/blog/tags/%E5%8D%8E%E4%B8%89HCL/">华三HCL</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/blog/shx.html" title="双核心大型企业网组建实训"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-17</div><div class="title">双核心大型企业网组建实训</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#README"><span class="toc-text">README</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#H3C%E7%BD%91%E7%BB%9C%E5%AD%A6%E9%99%A2%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E7%AC%AC1%E5%8D%B7"><span class="toc-text">H3C网络学院路由交换技术第1卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86"><span class="toc-text">命令整理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B"><span class="toc-text">信息查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E8%BE%93%E5%87%BA"><span class="toc-text">调试输出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E9%85%8D%E7%BD%AE"><span class="toc-text">清除配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-text">历史记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E7%9C%8B"><span class="toc-text">分页查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86"><span class="toc-text">时间管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86"><span class="toc-text">设备管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%88%87%E6%8D%A2"><span class="toc-text">视图切换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">常用操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Console%E7%99%BB%E5%BD%95"><span class="toc-text">Console登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Telnet%E7%99%BB%E5%BD%95"><span class="toc-text">Telnet登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSH%E7%99%BB%E5%BD%95"><span class="toc-text">SSH登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FTP"><span class="toc-text">FTP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B"><span class="toc-text">路由与交换技术高级配置教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%98%E8%AF%AF"><span class="toc-text">勘误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-VLAN-%E9%85%8D%E7%BD%AE"><span class="toc-text">1.VLAN 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EMAC%E5%9C%B0%E5%9D%80"><span class="toc-text">基于MAC地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%8D%8F%E8%AE%AE"><span class="toc-text">基于协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EIP%E5%AD%90%E7%BD%91"><span class="toc-text">基于IP子网</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-GVRP"><span class="toc-text">2.GVRP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GVRP%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">GVRP基本配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GVRP-%E7%AB%AF%E5%8F%A3%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE"><span class="toc-text">GVRP 端口注册模式配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Isolate-user-vlan"><span class="toc-text">3.Isolate-user-vlan</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Super-VLAN"><span class="toc-text">Super VLAN</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-VLAN-VPN"><span class="toc-text">4.VLAN VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VLAN-VPN-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">VLAN VPN 基本配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-VLAN-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-text">5.VLAN 静态路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-VLAN%E9%97%B4%E8%B7%AF%E7%94%B1"><span class="toc-text">6.VLAN间路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9FVLAN%E9%97%B4%E8%B7%AF%E7%94%B1"><span class="toc-text">传统VLAN间路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E8%87%82%E8%B7%AF%E7%94%B1"><span class="toc-text">单臂路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-text">三层交换机</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-STP"><span class="toc-text">7.STP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-RSTP"><span class="toc-text">8.RSTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-MSTP"><span class="toc-text">9.MSTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1%E9%9D%99%E6%80%81ECMP"><span class="toc-text">10.1静态ECMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2%E6%B5%AE%E5%8A%A8%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-text">10.2浮动静态路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-OSPF"><span class="toc-text">11.OSPF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%8C%BA%E5%9F%9FOSPF%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">单区域OSPF基本配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%8C%BA%E5%9F%9FOSPF%E5%A2%9E%E5%BC%BA%E9%85%8D%E7%BD%AE"><span class="toc-text">单区域OSPF增强配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%8C%BA%E5%9F%9FOSPF%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">多区域OSPF基本配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-OSPF%E8%B7%AF%E7%94%B1%E8%81%9A%E5%90%88"><span class="toc-text">12.OSPF路由聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ABR%E8%81%9A%E5%90%88"><span class="toc-text">ABR聚合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ASBR%E8%81%9A%E5%90%88"><span class="toc-text">ASBR聚合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-OSPF-Stub%E5%8C%BA%E5%9F%9F%E5%92%8CNSSA%E5%8C%BA%E5%9F%9F"><span class="toc-text">13. OSPF Stub区域和NSSA区域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Stub%E5%8C%BA%E5%9F%9F"><span class="toc-text">Stub区域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSSA%E5%8C%BA%E5%9F%9F"><span class="toc-text">NSSA区域</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-OSPF-%E8%99%9A%E8%BF%9E%E6%8E%A5%E5%92%8C%E8%AE%A4%E8%AF%81%E9%85%8D%E7%BD%AE"><span class="toc-text">14.OSPF 虚连接和认证配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E5%8D%95%E5%8C%BA%E5%9F%9FIS-IS"><span class="toc-text">15.单区域IS-IS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-%E5%A4%9A%E5%8C%BA%E5%9F%9FIS-IS%E3%80%81%E5%BC%80%E9%94%80%E5%80%BC%E3%80%81%E8%81%9A%E5%90%88%E3%80%81%E8%AE%A4%E8%AF%81"><span class="toc-text">16.多区域IS-IS、开销值、聚合、认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-%E4%BD%BF%E7%94%A8-filter-policy-%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1"><span class="toc-text">17.使用 filter-policy 过滤路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-%E4%BD%BF%E7%94%A8-Route-policy-%E6%8E%A7%E5%88%B6%E8%B7%AF%E7%94%B1"><span class="toc-text">18.使用 Route-policy 控制路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-%E4%BD%BF%E7%94%A8-PBR-%E5%AE%9E%E7%8E%B0%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1"><span class="toc-text">19.使用 PBR 实现策略路由</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By null</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/blog/js/utils.js"></script><script src="/blog/js/main.js"></script><script src="/blog/js/tw_cn.js"></script><script src="/blog/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>